# Zabbix Basic CPU Temperature Monitoring

ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¸ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ñ€Ð° (Ð¿Ð¾ÑÐ´ÐµÑ€Ð½Ð¾ + Ð¾Ð±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°) Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ `lm-sensors` Ð¸ Zabbix Agent.

ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ ÑÑ‚Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸ â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ **UserParameters (One-liners)** Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ð¼ÐµÑ‚Ñ€Ð¸Ðº, Ñ‡Ñ‚Ð¾ Ð¼Ð¸Ð½Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð². Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Discovery (LLD).

## Credits / ÐÐ²Ñ‚Ð¾Ñ€Ñ‹

* **ÐÐ²Ñ‚Ð¾Ñ€ Ð¸Ð´ÐµÐ¸ / Original Idea:** [B1T0 (Tobias Scheithauer)](https://github.com/B1T0/zabbix-basic-cpu-temperature)
* **ÐÐ´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ð¸ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ / Adaptation:** [didimozg](https://github.com/didimozg)

## Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

* ðŸ”¥ **Discovery:** ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… ÑÐ´ÐµÑ€ CPU.
* ðŸ“Š **ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸:**
    * Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÐ´Ñ€Ð°.
    * Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° (Avg).
    * ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° (Max).
    * ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° (Min).
* âš ï¸ **Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹:** ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¾ Ð¿ÐµÑ€ÐµÐ³Ñ€ÐµÐ²Ðµ (>85Â°C) Ð¸ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ (>95Â°C).
* ðŸ“ˆ **Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸:** Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¼Ð¸Ð½/ÑÑ€ÐµÐ´/Ð¼Ð°ÐºÑ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹.
* âœ… **Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:** Zabbix 7.0+, Zabbix Agent / Agent 2.

---

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

### Ð¨Ð°Ð³ 1: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ (Linux)

ÐÐ° Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¼ Ñ…Ð¾ÑÑ‚Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð°ÐºÐµÑ‚ `lm-sensors` Ð¸ ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð°.

```bash
sudo apt update
sudo apt install lm-sensors gawk -y

```

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´ÐµÑ‚ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐµÐ½ÑÐ¾Ñ€Ð¾Ð² Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚ÑŒÑ‚Ðµ `YES` Ð½Ð° Ð²ÑÐµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:

```bash
sudo sensors-detect

```

ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:

```bash
sensors

```

### Ð¨Ð°Ð³ 2: Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (Discovery)

Zabbix Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð»Ñ Ð½Ð¸Ð·ÐºÐ¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ð¾Ð³Ð¾ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (LLD). Ð”Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚.

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð»:
```bash
sudo nano /etc/zabbix/zabbix_agent2.d/get_cores.sh

```


*(Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ zabbix-agent, Ð¿ÑƒÑ‚ÑŒ Ð±ÑƒÐ´ÐµÑ‚ `/etc/zabbix/scripts/`)*
2. Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ:
```bash
#!/bin/bash
# JSON Generator for Zabbix CPU Core Discovery
first=1
echo "{\"data\":["
sensors | grep "^Core" | while read -r line; do
    # Extract core ID (assuming format "Core 0", "Core 1")
    core_id=$(echo "$line" | awk '{print $2}' | tr -d ':')

    if [ "$first" -eq 0 ]; then echo ","; fi
    echo -n "{\"{#CORE}\":\"$core_id\"}"
    first=0
done
echo "]}"

```


3. Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼:
```bash
sudo chmod +x /etc/zabbix/zabbix_agent2.d/get_cores.sh

```



### Ð¨Ð°Ð³ 3: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Zabbix Agent

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:
```bash
sudo nano /etc/zabbix/zabbix_agent2.d/userparameter_cputemp.conf

```


2. Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ (One-liners):
```ini
# Discovery script location
UserParameter=basicCPUTemp.discovery,/etc/zabbix/zabbix_agent2.d/get_cores.sh

# Min core temp (Â°C)
UserParameter=basicCPUTemp.min,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { t=substr(s,RSTART,RLENGTH)+0; if (c==0||t<min) min=t; c++ } } END{ if (c>0) printf("%.1f", min); else print "-1" }'

# Max core temp (Â°C)
UserParameter=basicCPUTemp.max,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { t=substr(s,RSTART,RLENGTH)+0; if (c==0||t>max) max=t; c++ } } END{ if (c>0) printf("%.1f", max); else print "-1" }'

# Avg core temp (Â°C)
UserParameter=basicCPUTemp.avg,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { sum+=substr(s,RSTART,RLENGTH)+0; c++ } } END{ if (c>0) printf("%.1f", sum/c); else print "-1" }'

# Specific core temp
UserParameter=basicCPUTemp.core[*],LC_ALL=C sensors 2>/dev/null | grep "^Core $1:" | awk '{print $3}' | sed 's/[^0-9.]//g'

```


3. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð°Ð³ÐµÐ½Ñ‚:
```bash
sudo systemctl restart zabbix-agent2

```



### Ð¨Ð°Ð³ 4: Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°

1. Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `template_cpu_temp_v7.yaml` Ð¸Ð· ÑÑ‚Ð¾Ð³Ð¾ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ.
2. Ð’ Zabbix Ð¿ÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² **Data collection** -> **Templates**.
3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **Import** Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐºÐ°Ñ‡Ð°Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð».
4. ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ðº Ð½ÑƒÐ¶Ð½Ð¾Ð¼Ñƒ Ñ…Ð¾ÑÑ‚Ñƒ.

---

**License:** MIT / GPL (as per original repo)

```

---

### ðŸ“„ Ð¤Ð°Ð¹Ð» 2: `template_cpu_temp_v7.yaml`

Ð­Ñ‚Ð¾ ÑÐ°Ð¼ Ñ„Ð°Ð¹Ð» ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð´Ð»Ñ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ (Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ UUIDv4).

```yaml
zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: '7df96b18c230490a9a0a9e2307226338'
      name: Templates
  templates:
    - uuid: 'b9ff215cd8774e7780fc596eb582605b'
      template: 'Template basicCPUTemp'
      name: 'Template basicCPUTemp'
      description: |
        Template for monitoring CPU Temperature using lm-sensors.
        Uses optimized awk one-liners in agent config.
        
        Original idea: https://github.com/B1T0/zabbix-basic-cpu-temperature
        Adaptation: https://github.com/didimozg
      groups:
        - name: Templates
      items:
        - uuid: 'fec5da56886b40c48740a057d2be9c54'
          name: 'CPU Temperature Avg'
          key: basicCPUTemp.avg
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: Â°C
          tags:
            - tag: Application
              value: Temperature
        - uuid: '627b89d7b1954d2ea649b23b8e83576a'
          name: 'CPU Temperature Max'
          key: basicCPUTemp.max
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: Â°C
          tags:
            - tag: Application
              value: Temperature
          triggers:
            - uuid: 'f5075d392fd7436c8b89ae7cb74ab143'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.max)>90.0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'avg(/Template basicCPUTemp/basicCPUTemp.max,60s)<75'
              name: 'Temperature high'
              priority: AVERAGE
            - uuid: '8347731ec5fb4fa3a1201fc0983b8cde'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.max)>95'
              recovery_mode: NONE
              name: 'Temperature too high'
              priority: DISASTER
              manual_close: 'YES'
        - uuid: '3b42e6a5c4c7418386961bb570d63b63'
          name: 'CPU Temperature Min'
          key: basicCPUTemp.min
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: Â°C
          tags:
            - tag: Application
              value: Temperature
      discovery_rules:
        - uuid: 'aab958191be14454bbdecf00a6416b4d'
          name: 'CPU Cores Discovery'
          key: basicCPUTemp.discovery
          delay: 1h
          item_prototypes:
            - uuid: 'ab914fed6b4f477781dd24f4be9cf1b8'
              name: 'CPU Core {#CORE} Temp'
              key: 'basicCPUTemp.core[{#CORE}]'
              value_type: FLOAT
              units: Â°C
          trigger_prototypes:
            - uuid: '79a29e4682024220b224151475756303'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}])>85'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'avg(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}],3m)<75'
              name: 'High temperature on Core {#CORE} (>85Â°C)'
              priority: HIGH
            - uuid: '81c6260196884849925e016147101867'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}])>95'
              name: 'Critical temperature on Core {#CORE} (>95Â°C)'
              priority: DISASTER
  graphs:
    - uuid: 'ff78a7a1ff9740198ff9c40fc3fce6ea'
      name: 'CPU Temperature'
      graph_items:
        - drawtype: BOLD_LINE
          color: 1A7C11
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.min
        - sortorder: '1'
          drawtype: BOLD_LINE
          color: 2774A4
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.avg
        - sortorder: '2'
          drawtype: BOLD_LINE
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.max

