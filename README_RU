# üå°Ô∏è Zabbix Basic CPU Temperature Monitoring

![Zabbix Version](https://img.shields.io/badge/Zabbix-7.0%2B-blue) ![Agent](https://img.shields.io/badge/Zabbix_Agent-2-green) ![License](https://img.shields.io/badge/License-MIT-grey)

–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –≤ Zabbix.
–†–µ—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ `lm-sensors` –∏ –º–∏–Ω–∏–º—É–º –≤–Ω–µ—à–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ (One-liners).

### ‚≠êÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
* **–ê–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (LLD):** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —è–¥—Ä–∞ CPU.
* **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —è–¥—Ä–∞ + Min/Max/Avg –ø–æ –≤—Å–µ–º—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É.
* **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `awk` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥–∞ –∞–≥–µ–Ω—Ç–∞ (–±–µ–∑ –∫—É—á–∏ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤).
* **Zabbix 7.4 Ready:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å UUIDv4 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –≤ –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ Zabbix.

---

## üë• Credits / –ê–≤—Ç–æ—Ä—ã

> **Original Idea:** [B1T0 (Tobias Scheithauer)](https://github.com/B1T0/zabbix-basic-cpu-temperature) ‚Äî *–ò–¥–µ—è –∏ –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.*
>
> **Adaptation & Fixes:** [didimozg](https://github.com/didimozg) ‚Äî *–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ Zabbix 7.x, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UUID, –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ UserParameters.*

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã (Linux)
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–Ω—Å–æ—Ä–∞–º–∏:

```bash
sudo apt update
sudo apt install lm-sensors gawk -y

```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–µ–Ω—Å–æ—Ä–æ–≤ (–æ—Ç–≤–µ—á–∞–π—Ç–µ **YES** –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã):

```bash
sudo sensors-detect

```

### 2. –°–∫—Ä–∏–ø—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (Discovery)

Zabbix —Ç—Ä–µ–±—É–µ—Ç JSON –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤. –°–æ–∑–¥–∞–¥–∏–º –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∫—Ä–∏–ø—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä.

**–§–∞–π–ª:** `/etc/zabbix/zabbix_agent2.d/get_cores.sh`

```bash
#!/bin/bash
# JSON Generator for Zabbix CPU Core Discovery
first=1
echo "{\"data\":["
sensors | grep "^Core" | while read -r line; do
    # –ü–∞—Ä—Å–∏–º ID —è–¥—Ä–∞ (Core 0, Core 1...)
    core_id=$(echo "$line" | awk '{print $2}' | tr -d ':')
    
    if [ "$first" -eq 0 ]; then echo ","; fi
    echo -n "{\"{#CORE}\":\"$core_id\"}"
    first=0
done
echo "]}"

```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:

```bash
sudo chmod +x /etc/zabbix/zabbix_agent2.d/get_cores.sh

```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ê–≥–µ–Ω—Ç–∞

–î–æ–±–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –í—Å—è –º–∞–≥–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–¥–µ—Å—å.

**–§–∞–π–ª:** `/etc/zabbix/zabbix_agent2.d/userparameter_cputemp.conf`

```ini
# --- CPU Temperature Monitoring ---

# Discovery script
UserParameter=basicCPUTemp.discovery,/etc/zabbix/zabbix_agent2.d/get_cores.sh

# Metrics (One-liners using awk)
UserParameter=basicCPUTemp.min,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { t=substr(s,RSTART,RLENGTH)+0; if (c==0||t<min) min=t; c++ } } END{ if (c>0) printf("%.1f", min); else print "-1" }'

UserParameter=basicCPUTemp.max,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { t=substr(s,RSTART,RLENGTH)+0; if (c==0||t>max) max=t; c++ } } END{ if (c>0) printf("%.1f", max); else print "-1" }'

UserParameter=basicCPUTemp.avg,LC_ALL=C sensors 2>/dev/null | awk '/^Core [0-9]+:/ { s=$0; sub(/^.*: */, "", s); if (match(s, /[-+]?[0-9]+(\.[0-9]+)?/)) { sum+=substr(s,RSTART,RLENGTH)+0; c++ } } END{ if (c>0) printf("%.1f", sum/c); else print "-1" }'

# Specific core temp
UserParameter=basicCPUTemp.core[*],LC_ALL=C sensors 2>/dev/null | grep "^Core $1:" | awk '{print $3}' | sed 's/[^0-9.]//g'

```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≥–µ–Ω—Ç:

```bash
sudo systemctl restart zabbix-agent2

```

### 4. –ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ –≤ Zabbix

1. –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª `template_cpu_temp_v7.yaml` –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
2. –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ: **Data collection** ‚Üí **Templates** ‚Üí **Import**.
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª.
4. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —à–∞–±–ª–æ–Ω *Template basicCPUTemp* –∫ –Ω—É–∂–Ω–æ–º—É —Ö–æ—Å—Ç—É.

---

### ‚ùì Troubleshooting (–ü—Ä–æ–≤–µ—Ä–∫–∞)

–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–µ—Ç—Ä–∏–∫ –ø—Ä—è–º–æ —Å —Å–µ—Ä–≤–µ—Ä–∞ Zabbix –∏–ª–∏ –ø—Ä–æ–∫—Å–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Discovery (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON)
zabbix_get -s <TARGET_IP> -k basicCPUTemp.discovery

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
zabbix_get -s <TARGET_IP> -k basicCPUTemp.avg

```

```

---

### üì¶ –§–∞–π–ª —à–∞–±–ª–æ–Ω–∞: `template_cpu_temp_v7.yaml`

–≠—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–∞–π–ª–∞ (100% –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Zabbix 7.4). –ü–æ–ª–æ–∂–∏—Ç–µ –µ–≥–æ —Ä—è–¥–æ–º —Å README.

```yaml
zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: '7df96b18c230490a9a0a9e2307226338'
      name: Templates
  templates:
    - uuid: 'b9ff215cd8774e7780fc596eb582605b'
      template: 'Template basicCPUTemp'
      name: 'Template basicCPUTemp'
      description: |
        Template for monitoring CPU Temperature using lm-sensors.
        Uses optimized awk one-liners in agent config.
        
        Original idea: https://github.com/B1T0/zabbix-basic-cpu-temperature
        Adaptation & Fixes: https://github.com/didimozg
      groups:
        - name: Templates
      items:
        - uuid: 'fec5da56886b40c48740a057d2be9c54'
          name: 'CPU Temperature Avg'
          key: basicCPUTemp.avg
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: ¬∞C
          tags:
            - tag: Application
              value: Temperature
        - uuid: '627b89d7b1954d2ea649b23b8e83576a'
          name: 'CPU Temperature Max'
          key: basicCPUTemp.max
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: ¬∞C
          tags:
            - tag: Application
              value: Temperature
          triggers:
            - uuid: 'f5075d392fd7436c8b89ae7cb74ab143'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.max)>90.0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'avg(/Template basicCPUTemp/basicCPUTemp.max,60s)<75'
              name: 'Temperature high'
              priority: AVERAGE
            - uuid: '8347731ec5fb4fa3a1201fc0983b8cde'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.max)>95'
              recovery_mode: NONE
              name: 'Temperature too high'
              priority: DISASTER
              manual_close: 'YES'
        - uuid: '3b42e6a5c4c7418386961bb570d63b63'
          name: 'CPU Temperature Min'
          key: basicCPUTemp.min
          delay: 10s
          history: 90d
          value_type: FLOAT
          units: ¬∞C
          tags:
            - tag: Application
              value: Temperature
      discovery_rules:
        - uuid: 'aab958191be14454bbdecf00a6416b4d'
          name: 'CPU Cores Discovery'
          key: basicCPUTemp.discovery
          delay: 1h
          item_prototypes:
            - uuid: 'ab914fed6b4f477781dd24f4be9cf1b8'
              name: 'CPU Core {#CORE} Temp'
              key: 'basicCPUTemp.core[{#CORE}]'
              value_type: FLOAT
              units: ¬∞C
          trigger_prototypes:
            - uuid: '79a29e4682024220b224151475756303'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}])>85'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'avg(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}],3m)<75'
              name: 'High temperature on Core {#CORE} (>85¬∞C)'
              priority: HIGH
            - uuid: '81c6260196884849925e016147101867'
              expression: 'last(/Template basicCPUTemp/basicCPUTemp.core[{#CORE}])>95'
              name: 'Critical temperature on Core {#CORE} (>95¬∞C)'
              priority: DISASTER
  graphs:
    - uuid: 'ff78a7a1ff9740198ff9c40fc3fce6ea'
      name: 'CPU Temperature'
      graph_items:
        - drawtype: BOLD_LINE
          color: 1A7C11
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.min
        - sortorder: '1'
          drawtype: BOLD_LINE
          color: 2774A4
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.avg
        - sortorder: '2'
          drawtype: BOLD_LINE
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Template basicCPUTemp'
            key: basicCPUTemp.max

```
